---
- name: Create Tomcat file repository
  hosts: "{{sat_host}}"
  become: True
  gather_facts: False

  vars_files:
   - vars/app_vars.yml

  tasks:

    - name: Unlock Satellite maintain packages
      command: >
        satellite-maintain packages unlock

    - name: Install pulp manifest package
      ansible.builtin.dnf:
        name: python39-pulp_manifest
        state: present

    - name: Lock Satellite maintain packages
      command: >
        satellite-maintain packages lock

    - name: Check if local pulp directory exist for Tomcat 
      ansible.builtin.stat:
        path: "{{ stat_result.value.app_path }}"
      loop: "{{ tomcat_vars | dict2items }}" 
      loop_control: 
        loop_var: stat_result
      register: stat_pulp_dir

    - ansible.builtin.debug:
        var: stat_pulp_dir

    - ansible.builtin.fail:
        msg: I failed it
    
    - name: Create directory to host Tomcat files
      ansible.builtin.file:
        state: "{{ 'directory' if item.stat.exists else 'directory' }}"
        path: "{{ item.stat_result.app_path }}"
        group: pulp
        owner: pulp
      loop: "{{ stat_pulp_dir.results }}" 
      